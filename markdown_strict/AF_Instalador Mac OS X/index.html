<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>AF Instalador Mac OS X - My Docs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "AF Instalador Mac OS X";
        var mkdocs_page_input_path = "markdown_strict/AF_Instalador Mac OS X.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> My Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Welcome to MkDocs</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Markdown strict</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Firmar_AutoFirma_Linux/">AF Firmar AutoFirma Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Firmar_AutoFirma_OS_X/">AF Firmar AutoFirma OS X</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Instalador%20Linux/">Preparación del entorno</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">AF Instalador Mac OS X</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#actualizacion-de-la-jre">Actualización de la JRE</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Instalador%20Windows/">AF Instalador Windows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_desarrollo_plugins_ES/">AF manual desarrollo plugins ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_instalacion_usuarios_ES/">AF manual instalacion usuarios ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_instalacion_y_gestion_ES/">AF manual instalacion y gestion ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ANEXO_Firma-electronica-en-varias-fases/">Firma electrónica en tres fases</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_arquitectura_ES/">CF arquitectura ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_catalogo_aplicaciones/">CF catalogo aplicaciones</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_distribuciones/">CF distribuciones</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_funcional_ES/">CF funcional ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-incidencias/">CF guia incidencias</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-uso-interfaz/">CF guia uso interfaz</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-uso/">CF guia uso</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-firmas-pdf/">CF manual firmas pdf</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-firmas-xml/">CF manual firmas xml</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-integrador/">CF manual integrador</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-migracion/">CF manual migracion</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual_integracion_modulos_ES/">CF manual integracion modulos ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_plan-pruebas/">CF plan pruebas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_roadmap_ES/">CF roadmap ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Comunicacion_Navegador_y_App_en_Entorno_Movil/">El camino de ida: Desde el navegador Web hacia la App</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../DECLARACION_ACCESIBILIDAD/">Declaración de Accesibilidad</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Diagramas%20de%20secuencia%20de%20los%20procesos%20de%20firma%20m%C3%B3vil/">Firma monofásica (Windows 8 / Windows RT y Android)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Firma_por_lotes_predefinidos_con_el_MiniApplet_Cliente/">Firma por lotes predefinidos con el MiniApplet Cliente</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Informe%20-%20Alternativas_Applets_para_firma/">Informe   Alternativas Applets para firma</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Invocaci%C3%B3n%20por%20protocolo%20de%20aplicaciones%20nativas%20desde%20p%C3%A1ginas%20Web/">¿Qué es la invocación por protocolo?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../La_seguridad_en_el_Servicio_de_firma_del_Cliente/">Tabla de contenido</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MCF_manual-integrador_ES/">MCF manual integrador ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MCF_roadmap_ES/">MCF roadmap ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Manual%20para%20la%20configuraci%C3%B3n%20de%20los%20campos%20de%20firma%20para%20la%20aplicaci%C3%B3n%20de%20firma%20manuscrita%20en%20tableta/">Manual para la configuración de los campos de firma para la aplicación de firma manuscrita en tableta</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_Manual_App_Portafirmas_Android/">PF Manual App Portafirmas Android</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_Manual_App_Portafirmas_iOS/">PF Manual App Portafirmas iOS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_manual-configuracion_servicios_ES/">PF manual configuracion servicios ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Sintaxis_invocacion_Cliente_Afirma/">Sintaxis invocacion Cliente Afirma</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../afirma_movil_intro/"><<img src="media/image1.jpeg"</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">My Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Markdown strict</li>
      <li class="breadcrumb-item active">AF Instalador Mac OS X</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>El proceso de generación de un instalador .<em>pkg</em> de la aplicación
AutoFirma consta de cuatro fases principales. Una primera en la que se
prepara un directorio .app con los ficheros necesarios para realizar la
instalación. Posteriormente este directorio debe ser firmado. En la
tercera fase se genera el fichero <em>.pkg</em> a partir del directorio .app
firmado anteriormente. Por último se firma el fichero <em>.pkg</em> generado.</p>
<p>Para realizar las firmas es preferible que se realice con un certificado
para firmar código expedido por Apple.</p>
<h1 id="generando-la-estructura-de-directorios-y-los-scripts-de-pre-y-post-instalacion">Generando la estructura de directorios y los scripts de pre y post instalación.</h1>
<p>La estructura de carpetas para generación el instalador es la siguiente:</p>
<ul>
<li>
<p><em>AutoFirma.app</em>. Es la aplicación AutoFirma. En realidad, esta
    aplicación es una estructura de directorios con una organización
    concreta.</p>
</li>
<li>
<p><em>scripts</em>: Es la carpeta que contiene el script de postinstalación.</p>
</li>
</ul>
<p>La estructura de carpetas para el empaquetado ya incluye todos los
ficheros necesarios para el empaquetado del producto a excepción de los
JAR de AutoFirma y el configurador.</p>
<p>Para incluir estos ficheros debemos hacer clic en el fichero
<em>AutoFirma.app</em> con el botón secundario del ratón (o con el botón
primario y la tecla Control pulsada) y seleccionar “Mostar el contenido
del paquete”. Los JAR se deberán almacenar en el directorio
/<strong>Contents/Resources/JAR</strong> con los nombres “<strong>AutoFirma.jar</strong>” y
“<strong>AutoFirmaConfigurador.jar</strong>”, respectivamente.</p>
<p>El contenido del directorio “<em>AutoFirma.app”</em> debería quedar así:</p>
<p>&lt;<img src="media/image1.png"
style="width:4.53056in;height:3.91319in"
alt="D:\Captura de pantalla 2016-03-31 a las 18.31.10.png" /></p>
<p><strong>IMPORTANTE:</strong> Es importante tener en cuenta al instalar AutoFirma que,
si existe una versión anterior ya instalada, la aplicación se instalará
en la misma ruta que esta y no en la carpeta Aplicaciones.</p>
<h2 id="actualizacion-de-la-jre">Actualización de la JRE</h2>
<p>Si se desea actualizar la versión de Java incluida en el paquete de
instalación, se puede eliminar el contenido del directorio
/<strong>Contents/Resources/Home</strong> y reemplazarlo por el directorio “Home” de
la JRE que desee incluir. Se recomienda reducir el tamaño del JRE
eliminando componentes que no utilice AutoFirma (como las extensiones y
bibliotecas de JavaFX, por ejemplo). A continuación:</p>
<ol>
<li>
<p>Hay que realizar una copia del ejecutable “java” en el mismo
    directorio, y cambiarles el nombre al fichero original y a la copia
    para llamarlos:</p>
<ul>
<li>
<p>AutoFirma -&gt; Se encargará de ejecutar AutoFirma.jar</p>
</li>
<li>
<p>ejecutar -&gt; Se encargará de ejecutar
    AutoFirmaConfigurador.jar</p>
</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>No puede haber un fichero que se llame java</strong></p>
</blockquote>
<ol>
<li>
<p>Se debe copiar al directorio “bin”, donde se encuentran los de
    ejecutables de Java, las bibliotecas “libnss3.dylib”,
    “libmozglue.dylib” y “libsoftokn3.dylib” que vienen con Firefox.
    Esto es necesario porque será en este directorio en donde busque
    Java estas bibliotecas cuando intente acceder al almacén de
    certificados de Firefox.</p>
</li>
<li>
<p>Se debe introducir en el almacén de confianza de la nueva JRE los
    certificados de las autoridades de certificación que se deseen. Para
    facilitar esta tarea, se provee del script “insert_certs.sh”. Este
    script deberá localizarse en el directorio de los certificados a
    insertar y deberán reajustarse en el script las rutas de la JRE a la
    que se le desean agregar los certificados.</p>
</li>
</ol>
<h1 id="generar-el-fichero-pkg-en-os-x">Generar el fichero .pkg en OS X</h1>
<p>Para la generación del instalador de AutoFirma se presentan 2
alternativas.</p>
<h1 id="generacion-mediante-packages">Generación mediante <em>packages</em></h1>
<p>La aplicación <em>packages</em> nos permite empaquetar una aplicación,
configurando aspectos que no es posible configurar mediante la
herramienta pkgbuild (que se presenta más adelante). La estructura de
empaquetado ya incluye un proyecto de packages, llamado
<em>AutoFirma.pkgproj</em>, situado junto a “AutoFirma.app” y el directorio
“scripts”, a los que hace referencia.</p>
<p>Para la generación del paquete, primeramente, se deberá abrir el
proyecto “<em>AutoFirma.pkgproj</em>”. La aplicación packages se nos presentará
con una apariencia similar a la siguiente:</p>
<p>&lt;<img src="media/image2.png"
style="width:6.5in;height:3.70069in" /></p>
<p>En caso de que fuese necesario (por haber copiado el proyecto), se
deberán corregir las referencias a los directorios “AutoFirma.app” y
“scripts”.</p>
<p>Para construir el proyecto basta con acceder al menú “Build” y pulsar en
la opción “Build” (Command+B).</p>
<p>El paquete se creará con el nombre “AutoFirma.pkg” en el mismo
directorio que el fichero de proyecto.</p>
<h1 id="generacion-por-linea-de-comandos">Generación por línea de comandos</h1>
<p>Hay que ejecutar el comando <strong><em>pkgbuild</em></strong> con los siguientes
parámetros:</p>
<p>pkgbuild --install-location &lt;installation-path&gt; --scripts
&lt;scripts-path&gt; --component &lt;component-path&gt;
&lt;package-output-path&gt;</p>
<ul>
<li>
<p>installation-path<strong>:</strong> Ruta donde se instalará el paquete, la ruta
    habitual suele ser: /Applications</p>
</li>
<li>
<p>scripts-path: Ruta donde se encuentra la carpeta con los scripts.</p>
</li>
<li>
<p>component-path<u>:</u> Ruta del fichero .app que se añade al
    instalador. En nuestro caso “Cliente @firma para OS X.app”</p>
</li>
<li>
<p>package-output-path<u>:</u> Ruta donde se generará el instalador
    .<em>pkg</em>. En nuestro caso AutoFirmaInstaller.pkg</p>
</li>
</ul>
<p>Si todo ha ocurrido sin problemas se mostrarán los siguientes mensajes:</p>
<p>Pkgbuild: Adding component at component-path</p>
<p>Pkgbuild: Addig top-level postinstall script (si hay preinstall script
aparecerá un mensaje análogo)</p>
<p>Pkgbuild: Wrote package to package-output-path</p>
<p>El fichero <em>.pkg</em> se habrá generado y se podrá ejecutar haciendo doble
clic.</p>
<p>Si no sale el mensaje “Adding top-level … script” quiere decir que no ha
reconocido el script de postinstalación, repasa el punto 2.</p>
<p>Para una información más detallada sobre el comando <em>pkgbuild</em> y sus
parámetros consultar la ayuda de Apple:</p>
<p><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/pkgbuild.1.html">https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/pkgbuild.1.html</a></p>
<h1 id="firmar-el-fichero-pkg-en-os-x">Firmar el fichero .pkg en OS X</h1>
<p>Para firmar el fichero <em>.pkg</em> es necesario un certificado de
desarrollador expedido por Apple válido para la distribución de
aplicaciones OS X (consulte con Apple para más información).</p>
<p>Hay que ejecutar el siguiente comando:</p>
<p>productsign –sign &lt;Nombre certificado&gt; &lt;original.pkg&gt;
&lt;firmado.pkg&gt;</p>
<ul>
<li>
<p>Nombre certificado: Nombre del certificado tal como aparece en el
    llavero de OS X (podemos observarlo en la siguiente imagen).</p>
</li>
<li>
<p>original.pkg: Nombre del fichero <em>.pkg</em> que queremos firmar.</p>
</li>
<li>
<p>firmado.pkg: Nombre del <em>.pkg</em> firmado (No tiene por qué ser el
    mismo nombre que el original).</p>
</li>
</ul>
<p>&lt;<img src="media/image3.png"
style="width:6.48681in;height:2.4in"
alt="D:\Captura de pantalla 2016-03-31 a las 14.30.22.png" /></p>
<p>Ejemplo:</p>
<p>productsign –sign
com.apple.idms.appleid.prd.6f5772585537487363e4d76793868355a48413369673d3d
./Desktop/test/”Cliente @firma para OS X.pkg” AutoFirma_1.5.pkg</p>
<p>Si todo ha ocurrido sin problemas se mostrarán los siguientes mensajes:</p>
<p>productsign: adding certificate “Apple Application Integration
Certification Authority”</p>
<p>productsign: adding certificate “Apple Root CA”</p>
<p>productsign: Wrote signed_product archive to AutoFirma_1.5_installer.pkg</p>
<p>Tal como vemos en la siguiente imagen:</p>
<p>&lt;<img src="media/image4.png"
style="width:6.48681in;height:0.48681in"
alt="D:\Captura de pantalla 2016-03-31 a las 19.30.25.png" /></p>
<p>Para una información más detallada sobre el comando <strong><em>productsign</em></strong> y
sus parámetros consultar la ayuda de Apple:</p>
<p><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/productsign.1.html">https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/productsign.1.html</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../AF_Instalador%20Linux/" class="btn btn-neutral float-left" title="Preparación del entorno"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../AF_Instalador%20Windows/" class="btn btn-neutral float-right" title="AF Instalador Windows">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../AF_Instalador%20Linux/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../AF_Instalador%20Windows/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
