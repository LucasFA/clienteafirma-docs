<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Tabla de contenido - My Docs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Tabla de contenido";
        var mkdocs_page_input_path = "markdown_strict/La_seguridad_en_el_Servicio_de_firma_del_Cliente.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> My Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Welcome to MkDocs</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Markdown strict</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Firmar_AutoFirma_Linux/">AF Firmar AutoFirma Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Firmar_AutoFirma_OS_X/">AF Firmar AutoFirma OS X</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Instalador%20Linux/">Preparación del entorno</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Instalador%20Mac%20OS%20X/">AF Instalador Mac OS X</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Instalador%20Windows/">AF Instalador Windows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_desarrollo_plugins_ES/">AF manual desarrollo plugins ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_instalacion_usuarios_ES/">AF manual instalacion usuarios ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_instalacion_y_gestion_ES/">AF manual instalacion y gestion ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ANEXO_Firma-electronica-en-varias-fases/">Firma electrónica en tres fases</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_arquitectura_ES/">CF arquitectura ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_catalogo_aplicaciones/">CF catalogo aplicaciones</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_distribuciones/">CF distribuciones</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_funcional_ES/">CF funcional ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-incidencias/">CF guia incidencias</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-uso-interfaz/">CF guia uso interfaz</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-uso/">CF guia uso</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-firmas-pdf/">CF manual firmas pdf</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-firmas-xml/">CF manual firmas xml</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-integrador/">CF manual integrador</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-migracion/">CF manual migracion</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual_integracion_modulos_ES/">CF manual integracion modulos ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_plan-pruebas/">CF plan pruebas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_roadmap_ES/">CF roadmap ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Comunicacion_Navegador_y_App_en_Entorno_Movil/">El camino de ida: Desde el navegador Web hacia la App</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../DECLARACION_ACCESIBILIDAD/">Declaración de Accesibilidad</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Diagramas%20de%20secuencia%20de%20los%20procesos%20de%20firma%20m%C3%B3vil/">Firma monofásica (Windows 8 / Windows RT y Android)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Firma_por_lotes_predefinidos_con_el_MiniApplet_Cliente/">Firma por lotes predefinidos con el MiniApplet Cliente</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Informe%20-%20Alternativas_Applets_para_firma/">Informe   Alternativas Applets para firma</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Invocaci%C3%B3n%20por%20protocolo%20de%20aplicaciones%20nativas%20desde%20p%C3%A1ginas%20Web/">¿Qué es la invocación por protocolo?</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Tabla de contenido</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MCF_manual-integrador_ES/">MCF manual integrador ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MCF_roadmap_ES/">MCF roadmap ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Manual%20para%20la%20configuraci%C3%B3n%20de%20los%20campos%20de%20firma%20para%20la%20aplicaci%C3%B3n%20de%20firma%20manuscrita%20en%20tableta/">Manual para la configuración de los campos de firma para la aplicación de firma manuscrita en tableta</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_Manual_App_Portafirmas_Android/">PF Manual App Portafirmas Android</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_Manual_App_Portafirmas_iOS/">PF Manual App Portafirmas iOS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_manual-configuracion_servicios_ES/">PF manual configuracion servicios ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Sintaxis_invocacion_Cliente_Afirma/">Sintaxis invocacion Cliente Afirma</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../afirma_movil_intro/"><<img src="media/image1.jpeg"</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">My Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Markdown strict</li>
      <li class="breadcrumb-item active">Tabla de contenido</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="tabla-de-contenido">Tabla de contenido</h1>
<p><a href="#introducción">Introducción [3](#introducción)</a></p>
<p><a href="#aplicación-autofirma">Aplicación AutoFirma [3](#aplicación-autofirma)</a></p>
<p><a href="#_Toc433741886">El siguiente diagrama ilustra un flujo de operación de firma básico:
[3](#_Toc433741886)</a></p>
<p><a href="#invocación-por-protocolo">Invocación por protocolo
[3](#invocación-por-protocolo)</a></p>
<p><a href="#qué-es-la-invocación-por-protocolo">¿Qué es la invocación por protocolo?
[3](#qué-es-la-invocación-por-protocolo)</a></p>
<p><a href="#invocación-por-protocolo-desde-navegador-web">Invocación por protocolo desde navegador Web
[4](#invocación-por-protocolo-desde-navegador-web)</a></p>
<p><a href="#comunicación-entre-aplicación-nativa-y-aplicación-javascript-en-el-navegador-que-inició-la-invocación-por-protocolo">Comunicación entre aplicación nativa y aplicación JavaScript en el
navegador que inició la invocación por protocolo
[6](#comunicación-entre-aplicación-nativa-y-aplicación-javascript-en-el-navegador-que-inició-la-invocación-por-protocolo)</a></p>
<p><a href="#funcionamiento-del-diálogo-entre-aplicación-autofirma-y-aplicación-javascript-en-navegador-web">Funcionamiento del diálogo entre aplicación AutoFirma y aplicación
JavaScript en navegador Web
[6](#funcionamiento-del-diálogo-entre-aplicación-autofirma-y-aplicación-javascript-en-navegador-web)</a></p>
<p><a href="#aplicación-autofirma-con-interfaz-gráfico-para-firmas-locales">Aplicación AutoFirma con interfaz gráfico para firmas locales
[7](#aplicación-autofirma-con-interfaz-gráfico-para-firmas-locales)</a></p>
<p><a href="#seguridad-de-la-aplicación-autofirma">Seguridad de la aplicación AutoFirma
[7](#seguridad-de-la-aplicación-autofirma)</a></p>
<p><a href="#seguridad-en-el-propio-instalador">Seguridad en el propio instalador
[7](#seguridad-en-el-propio-instalador)</a></p>
<p><a href="#microsoft-windows">Microsoft Windows [7](#microsoft-windows)</a></p>
<p><a href="#apple-os-x">Apple OS X [7](#apple-os-x)</a></p>
<p><a href="#linux">Linux [7](#linux)</a></p>
<p><a href="#cambios-realizados-en-el-sistema-durante-el-proceso-de-instalación">Cambios realizados en el sistema durante el proceso de instalación
[7](#cambios-realizados-en-el-sistema-durante-el-proceso-de-instalación)</a></p>
<p><a href="#registro-del-protocolo-afirma">Registro del protocolo “afirma”
[7](#registro-del-protocolo-afirma)</a></p>
<p><a href="#instalación-de-un-certificado-ssl-auto-firmado-como-de-confianza-para-el-sistema">Instalación de un certificado SSL auto firmado como de confianza para
el sistema
[8](#instalación-de-un-certificado-ssl-auto-firmado-como-de-confianza-para-el-sistema)</a></p>
<p><a href="#otros-cambios">Otros cambios [8](#otros-cambios)</a></p>
<p><a href="#seguridad-en-el-propio-binario-ejecutable-de-autofirma">Seguridad en el propio binario ejecutable de AutoFirma
[9](#seguridad-en-el-propio-binario-ejecutable-de-autofirma)</a></p>
<p><a href="#seguridad-en-el-propio-proceso-de-firma">Seguridad en el propio proceso de firma
[9](#seguridad-en-el-propio-proceso-de-firma)</a></p>
<h1 id="introduccion">Introducción</h1>
<h2 id="aplicacion-autofirma">Aplicación AutoFirma</h2>
<p>La aplicación AutoFirma es un programa que permite la realización de
firmas electrónicas integradas en flujos de trabajo Web accesibles por
parte de los usuarios firmantes mediante un simple navegador Web.</p>
<p>Las firmas electrónicas se realizan siempre en el equipo local del
firmante, accediendo de forma segura a las claves privadas y
certificados de firma almacenados en sus repositorios locales (del
navegador, del sistema operativo, en tarjetas inteligentes, etc.).</p>
<p>Al contrario que las aplicaciones comunes de firma electrónica Web,
AutoFirma no necesita que el navegador Web soporte Applets de Java, si
bien es necesario que esta aplicación esté instalada en el ordenador
local del usuario firmante antes de iniciar el trámite de firma
electrónica.</p>
<p>Para suplir la necesidad de soporte de Applets de Java, la aplicación
AutoFirma y la lógica JavaScript del flujo Web del trámite de firma
electrónica integran un JavaScript distribuido junto AutoFirma
(miniapplet.js). Mediante este JavaScript se ejecutan las distintas
operaciones de firma, para lo cual se arrancará la aplicación usando un
mecanismo denominado Invocación por Protocolo. Una vez arrancada la
aplicación se iniciará un diálogo bidireccional a través de un socket
entre el JavaScript de despliegue y AutoFirma. Por medio de este socket
se trasladarán a AutoFirma la orden de firma correspondiente y los datos
sobre los que operar.</p>
<h2 id="img">&lt;img</h2>
<p>src="La_seguridad_en_el_Servicio_de_firma_del_Cliente/media/image1.png"
style="width:0.81092in;height:0.81057in" /&gt;<img
src="La_seguridad_en_el_Servicio_de_firma_del_Cliente/media/image2.png"
style="width:0.81092in;height:0.81057in" /><img
src="La_seguridad_en_el_Servicio_de_firma_del_Cliente/media/image3.png"
style="width:0.74373in;height:0.7434in" />El siguiente diagrama ilustra un flujo de operación de firma básico:</p>
<h2 id="invocacion-por-protocolo">Invocación por protocolo</h2>
<h3 id="que-es-la-invocacion-por-protocolo">¿Qué es la invocación por protocolo?</h3>
<p>Es un funcionamiento universal que los sistemas operativos mantengan una
serie de asociaciones entre tipos de fichero y las aplicaciones que son
capaces de tratarlos. Así, si en un sistema operativo Windows se indica
que se abra un documento de texto, este consultará en el Registro de
Windows cual es la aplicación por defecto asociada para su tratamiento
(usualmente el Bloc de Notas), y procederá a abrir esta aplicación
pasando como parámetro la ruta completa del fichero en el esquema de
argumentos definido en el propio Registro de Windows como parte de la
asociación.</p>
<p>Esta asociación se hace de distintas formas según el sistema operativo,
en Windows es por su extensión (“.txt” en nuestro ejemplo), pero por
ejemplo en Linux es por su MIME-Type (text/plain en el ejemplo).</p>
<p>Este mismo esquema se define igualmente en la mayoría de los sistemas
operativos también para los esquemas comunes de protocolos basados en
URN/URI/URL. Así, si por ejemplo en un sistema operativo Windows
indicamos que queremos abrir http://www.google.com (por ejemplo, desde
la línea de comandos con la sentencia “start http://www.google.com”) se
iniciará el navegador Web por defecto, que es la aplicación asociada
para tratar el protocolo http, procediendo a abrir esa página Web.</p>
<p>Este modo de abrir aplicaciones se conoce como invocación por protocolo,
y de forma análoga a la invocación de aplicaciones indicando abrir un
fichero, donde antes se recibía la ruta completa del fichero a abrir,
ahora se recibe la URL/URI/URN completa que se indicó abrir.</p>
<p>La invocación por protocolo permite enviar parámetros a la aplicación de
destino como parte de la URL de invocación. Sin embargo, no es posible
transmitir datos desde la aplicación invocada a la aplicación que la
llamó, por lo que no puede devolverse ningún resultado.</p>
<h3 id="invocacion-por-protocolo-desde-navegador-web">Invocación por protocolo desde navegador Web</h3>
<p>Este mecanismo de invocación por protocolo de los sistemas operativos es
usualmente accesible desde los navegadores Web. Esto quiere decir que si
en la barra de direcciones del navegador Web indicamos una URI, el
navegador Web trasladará el control al sistema operativo para que este
localice la aplicación apropiada para tratar el protocolo asociado a la
URI, y la abra pasándole dicha URI.</p>
<p>Un ejemplo de este mecanismo en Apple iOS podría ser el soporte del
protocolo tel en forma de URN con el formato tel://1-408-555-5555, donde
1-408-555-5555 es un número de teléfono. Así una llamada desde una
página Web a esta URN con una sentencia HTML como la siguiente, &lt;a
href="tel://1-408-555-5555"&gt;1-408-555-5555&lt;/a&gt;,provoca que se
active el teléfono (en un iPhone) y realice una llamada a ese número, ya
que la aplicación nativa de teléfono de iOS tiene registrado ese esquema
de protocolo.</p>
<p>En este caso tenemos una salvedad evidente, y es que el navegador Web
obviará esta transferencia de control al sistema operativo cuando el
propio navegador sepa tratar el protocolo, por ejemplo, con http, https,
ftp, etc.</p>
<h4 id="advertencias-de-apertura">Advertencias de apertura</h4>
<p>Como la invocación por protocolo no deja de ser una transferencia de
datos desde una página Web (que no tiene porqué ser de confianza) a una
aplicación nativa, los navegadores Web acostumbran a advertir de este
cambio al usuario con un diálogo gráfico:</p>
<p><img
src="La_seguridad_en_el_Servicio_de_firma_del_Cliente/media/image4.png"
style="width:3.41667in;height:3.64583in"
alt="C:\Users\tomas\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.Outlook\Q2TC4JUS\windows7_firefox.png" /></p>
<p>Ilustración 1: Advertencia en Firefox sobre Windows 7</p>
<p><img
src="La_seguridad_en_el_Servicio_de_firma_del_Cliente/media/image5.png"
style="width:4.60417in;height:4.63542in"
alt="C:\Users\tomas\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.Outlook\Q2TC4JUS\windows7_chrome.png" /></p>
<p>Ilustración 2: Advertencia en Google Chrome sobre Windows 7</p>
<p><img
src="La_seguridad_en_el_Servicio_de_firma_del_Cliente/media/image6.png"
style="width:4.38542in;height:3.21875in"
alt="C:\Users\tomas\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.Outlook\Q2TC4JUS\windows7_ie9.png" /></p>
<p>Ilustración 3: Advertencia en Internet Explorer 9 sobre Windows 7</p>
<p>En general, todos los navegadores Web muestran algún tipo de
advertencia, excepto Apple Safari en Windows y OS X. En el caso de
Internet Explorer se comprueba además la firma electrónica del
ejecutable del programa nativo invocado.</p>
<h4 id="soporte-de-la-invocacion-por-protocolo-en-distintos-navegadores-web">Soporte de la invocación por protocolo en distintos navegadores Web</h4>
<p>Las pruebas de compatibilidad positiva se han realizado en los
siguientes entornos de escritorio compatibles con AutoFirma:</p>
<ul>
<li>
<p>Windows (XP, Vista, 7, 8, 8.1)</p>
</li>
<li>
<p>OS X (10.7, 10.8, 10.9)</p>
</li>
<li>
<p>Linux (varias distribuciones y versiones).</p>
</li>
</ul>
<h3 id="comunicacion-entre-aplicacion-nativa-y-aplicacion-javascript-en-el-navegador-que-inicio-la-invocacion-por-protocolo">Comunicación entre aplicación nativa y aplicación JavaScript en el navegador que inició la invocación por protocolo</h3>
<p>Como hemos comentado, una aplicación JavaScript ejecutándose en un
navegador Web puede invocar una aplicación nativa siempre que esta esté
registrada como la aplicación por defecto para tratar un protocolo que
no trate el propio navegador (por ejemplo, el Cliente @firma usa el
protocolo afirma en una URI del estilo afirma://), proporcionando
ciertos datos como parte de la propia URI de invocación, pero no hay
mecanismos predefinidos para, tras esta invocación, establecer un
diálogo bidireccional.</p>
<h2 id="funcionamiento-del-dialogo-entre-aplicacion-autofirma-y-aplicacion-javascript-en-navegador-web">Funcionamiento del diálogo entre aplicación AutoFirma y aplicación JavaScript en navegador Web</h2>
<p>Dado que, como se ha comentado anteriormente, no hay un mecanismo
predefinido para la comunicación entre una aplicación nativa ajena al
navegador Web y este último, en AutoFirma se ha implementado un
procedimiento de comunicación mediante HTTPS, donde la aplicación
AutoFirma actúa como servidor (mediante un <em>ServerSocket</em> SSL de Java) y
la aplicación JavaScript realiza llamadas HTTPS normales, dirigidas
siempre hacia la dirección 127.0.0.1, que siempre corresponde a la
máquina local del firmante.</p>
<p>El puerto del <em>socket</em> a través del cual se realiza la comunicación se
genera aleatoriamente en el JavaScript de integración y se envía a
AutoFirma mediante una invocación por protocolo. A partir de este
momento se inicia un diálogo bidireccional a través del <em>socket</em> SSL.</p>
<h3 id="_1"></h3>
<h3 id="aplicacion-autofirma-con-interfaz-grafico-para-firmas-locales">Aplicación AutoFirma con interfaz gráfico para firmas locales</h3>
<p>La aplicación AutoFirma permite su ejecución directa en local por parte
del usuario para la generación de firmas electrónicas sin necesidad de
su integración en un flujo Web. Sin embargo, este modo de ejecución está
fuera del alcance de este documento.</p>
<h1 id="seguridad-de-la-aplicacion-autofirma">Seguridad de la aplicación AutoFirma</h1>
<h2 id="seguridad-en-el-propio-instalador">Seguridad en el propio instalador</h2>
<h3 id="microsoft-windows">Microsoft Windows</h3>
<p>El instalador (.exe) va firmado electrónicamente, y MS-Windows es capaz
de comprobar la validez de la firma.</p>
<h3 id="apple-os-x">Apple OS X</h3>
<p>El instalador (.pkg) va firmado electrónicamente según los requisitos de
Apple para la generación de instaladores firmados.</p>
<h3 id="linux">Linux</h3>
<p>No hay firma electrónica, al no soportarse esta en los instaladores DEB
de Debian.</p>
<h2 id="_2"></h2>
<h2 id="cambios-realizados-en-el-sistema-durante-el-proceso-de-instalacion">Cambios realizados en el sistema durante el proceso de instalación</h2>
<h3 id="registro-del-protocolo-afirma">Registro del protocolo “afirma”</h3>
<p>Una de las tareas realizadas por el instalador es el registro del
protocolo “afirma” asociado a la aplicación AutoFirma, de modo que una
invocación al sistema operativo para la apertura de una URL del tipo
“afirma://” conllevará el arranque de la aplicación AutoFirma,
recibiendo esta la URL completa con la que fue instanciada.</p>
<p>Este registro se realiza de distinta manera según el sistema operativo:</p>
<h4 id="microsoft-windows_1">Microsoft Windows</h4>
<p>El registro del protocolo se realiza mediante el propio programa de
instalación (NSIS, Nullsoft Scriptable Install System), que ejecutándose
con privilegios de administrador, añade los siguientes valores en el
registro de Windows (sintaxis según NSIS, donde $INSTDIR es el
directorio de instalación de AutoFirma):</p>
<p>;Protocolo afirma</p>
<p>WriteRegStr HKEY_CLASSES_ROOT "afirma" "" "URL:Afirma Protocol"</p>
<p>WriteRegStr HKEY_CLASSES_ROOT "afirma\DefaultIcon" ""
"$INSTDIR\AutoFirma\ic_firmar.ico"</p>
<p>WriteRegStr HKEY_CLASSES_ROOT "afirma" "URL Protocol" ""</p>
<p>WriteRegStr HKEY_CLASSES_ROOT "afirma\shell\open\command" ""
"$INSTDIR\AutoFirma\AutoFirma.exe %1"</p>
<p>Estos valores son eliminados durante la desinstalación, igualmente por
el desinstalador de NSIS ejecutándose con permisos de administrador.</p>
<h4 id="apple-os-x_1">Apple OS X</h4>
<p>En Apple OS X el registro de protocolo se realiza en el info.plist de la
aplicación, con las siguientes líneas:</p>
<p>&lt;array&gt;</p>
<p>&lt;dict&gt;</p>
<p>&lt;key&gt;CFBundleURLSchemes&lt;/key&gt;</p>
<p>&lt;array&gt;</p>
<p>&lt;string&gt;afirma&lt;/string&gt;</p>
<p>&lt;/array&gt;</p>
<p>&lt;key&gt;CFBundleURLName&lt;/key&gt;</p>
<p>&lt;string&gt;Protocolo de invocación del Cliente @firma&lt;/string&gt;</p>
<p>&lt;/dict&gt;</p>
<p>&lt;/array&gt;</p>
<p>Dado que en Apple OS X el info.plist es interno a cada aplicación, se
elimina con esta (deshaciéndose el registro de protocolo).</p>
<p>El proceso no necesita permisos de administrador.</p>
<h4 id="linux_1">Linux</h4>
<p>En Linux se realiza una asociación del protocolo mediante una doble
declaración en el paquete DEB de instalación:</p>
<h5 id="declaracion-del-x-scheme-handler-en-el-desktop-de-gnome">Declaración del x-scheme-handler en el desktop de Gnome</h5>
<p>[Desktop Entry]</p>
<p>Encoding=UTF-8</p>
<p>Name=AutoFirma Cliente @firma</p>
<p>Comment=Cliente @firma</p>
<p>Exec=java -jar /usr/lib/autofirma/autofirma.jar</p>
<p>Icon=/usr/share/autofirma/autofirma.svg</p>
<p>MimeType=x-scheme-handler/afirma;</p>
<p>Terminal=false</p>
<p>Type=Application</p>
<p>Categories=GNOME;Application;Office</p>
<p>StartupNotify=true</p>
<p>StartupWMClass=autofirma</p>
<h5 id="declaracion-como-preferencia-de-mozilla-firefox-en-etcfirefoxpref">Declaración como preferencia de Mozilla Firefox en /etc/Firefox/pref</h5>
<p>pref("network.protocol-handler.app.afirma","/usr/bin/simpleafirma");</p>
<p>pref("network.protocol-handler.warn-external.afirma",false);</p>
<p>pref("network.protocol-handler.external.afirma",true);</p>
<h3 id="instalacion-de-un-certificado-ssl-auto-firmado-como-de-confianza-para-el-sistema">Instalación de un certificado SSL auto firmado como de confianza para el sistema</h3>
<p>El instalador, durante el proceso de instalación, genera un certificado
para comunicaciones SSL asociado al host “127.0.0.1” (la dirección
local).</p>
<p>Este certificado tiene las siguientes características:</p>
<ul>
<li>
<p>Se genera al vuelo durante el proceso de instalación.</p>
</li>
<li>
<p>El cálculo de claves usa el generador de números aleatorios por
    defecto de Java 8.</p>
</li>
<li>
<p>El tamaño de la clave es de 2048 bits.</p>
</li>
</ul>
<p>Este certificado, una vez generado:</p>
<ol>
<li>
<p>Se instala en el sistema como de confianza para servidores SSL.</p>
<ol>
<li>
<p>En Mozilla Firefox usando la herramienta “CertUtil” de Mozilla.</p>
</li>
<li>
<p>En MS-Windows usando las funciones de Java 8 de acceso a CAPI.</p>
</li>
<li>
<p>En OS X usando las funciones de Java 8 de acceso al llavero de
    OS X.</p>
</li>
</ol>
</li>
<li>
<p>Se guarda como PKCS#12 en el directorio de activos del programa
    AutoFirma ($HOME/.afirma, donde $HOME es el directorio del usuario)
    con una contraseña prefijada (en el propio código del aplicativo).</p>
</li>
</ol>
<h3 id="otros-cambios">Otros cambios</h3>
<p>El programa de instalación puede crear iconos en el menú inicio o el
escritorio del usuario, así como dar de alta el desinstalador (por
ejemplo, en el caso de Windows, para poder desinstalar la aplicación
desde la sección “Programas y Características” del Panel de Control),
pero ningún cambio que modifique o afecte a la seguridad del equipo del
usuario firmante.</p>
<h2 id="seguridad-en-el-propio-binario-ejecutable-de-autofirma">Seguridad en el propio binario ejecutable de AutoFirma</h2>
<p>Los binarios de AutoFirma están firmados digitalmente en el caso de
Microsoft Windows. Internet Explorer sobre Microsoft Windows es el único
navegador Web que comprueba las firmas electrónicas de los programas que
se han arrancado mediante una invocación por protocolo, y es la razón
por la que es el binario de Microsoft Windows el único firmado.</p>
<p><img
src="La_seguridad_en_el_Servicio_de_firma_del_Cliente/media/image7.png"
style="width:4.49607in;height:2.70668in" /></p>
<p>No se firman ni los binarios de OS X o Linux ni los JAR de Java internos
a la aplicación AutoFirma debido a que esta firma nunca se advierte de
su comprobación al usuario por protocolo (por lo que carece de
utilidad), pero si puede ocasionar retardos considerables en la carga de
la aplicación, puesto que internamente el sistema operativo si calcula
las huellas digitales e incluso consulta a los sistemas OCSP.</p>
<h2 id="seguridad-en-el-propio-proceso-de-firma">Seguridad en el propio proceso de firma</h2>
<p>El proceso de firma implementa distintas medidas de seguridad, que van
implícitas en la secuencia de uso:</p>
<ol>
<li>
<p>El navegador Web invoca por protocolo (afirma://…) a la aplicación
    AutoFirma.</p>
<ol>
<li>
<p>La invocación por protocolo no puede ser interceptada por un
    programa espía de conexiones de red, ya que no se realiza
    mediante TCP/IP ni UDP.</p>
</li>
<li>
<p>En la URL de invocación se indica (entre otras cosas):</p>
<ol>
<li>Una lista acotada de puertos aleatorios TCP de conexión,
    generados dentro del rango de puertos para uso dinámico
    (desde el 49152 al 65535).</li>
</ol>
</li>
</ol>
</li>
</ol>
<blockquote>
<p>De esta forma, el servicio se inicia cada vez en un puerto distinto y
aleatorio, dificultando ataques previamente planificados a puertos
concretos.</p>
</blockquote>
<ol>
<li>Un identificador de sesión aleatorio generado localmente al vuelo
    desde JavaScript. El identificador se generará usando las funciones
    de aleatorios de la “<em>Web Cryptography API</em>” si el motor JavaScript
    lo implementa o un algoritmo basado en la generación de aleatorios
    corriente y marcas de tiempo en caso de no hacerlo.</li>
</ol>
<!-- -->

<ol>
<li>
<p>El programa AutoFirma se inicia y abre un servicio servidor de tipo
    socket TCP SSL en uno de los puertos posibles de la lista recibida,
    respondiendo a un subconjunto del protocolo HTTPS.</p>
<ol>
<li>El servicio no es concurrente, una vez una instancia de
    AutoFirma acepta una conexión entrante en su puerto, ignora
    cualquier otra petición de conexión.</li>
</ol>
</li>
<li>
<p>El programa AutoFirma acepta la conexión SSL desde el JavaScript que
    ejecuta localmente el navegador Web.</p>
<ol>
<li>
<p>Solo se aceptan conexiones que provengan desde el mismo equipo
    local (localhost / 127.0.0.1). Cualquier conexión externa es
    rechazada.</p>
</li>
<li>
<p>Solo se aceptan conexiones que indiquen como parámetro en el
    diálogo el ID de sesión, que al haber sido generado al vuelo
    localmente y de forma aleatoria por el JavaScript nadie más
    puede conocer.</p>
</li>
</ol>
</li>
<li>
<p>El programa realiza la firma electrónica, para lo cual <strong>siempre</strong>
    habrá algún tipo de confirmación visual de cara al usuario firmante
    (usualmente, el mismo diálogo de selección de certificados).</p>
</li>
<li>
<p>Una vez termina el proceso (o pasa cierto tiempo sin intercambiarse
    mensajes), el programa se cierra, cerrándose a la vez el servicio
    SSL.</p>
<ol>
<li>
<p>El hecho de tener el servicio abierto únicamente el tiempo
    necesario reduce la ventana de tiempo en la que este puede
    recibir ataques.</p>
</li>
<li>
<p>Si se volviéndose a requerir la aplicación, se invocará
    nuevamente por protocolo proporcionándole nuevos puertos de
    conexión para el socket y un nuevo ID de sesión.</p>
</li>
</ol>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../Invocaci%C3%B3n%20por%20protocolo%20de%20aplicaciones%20nativas%20desde%20p%C3%A1ginas%20Web/" class="btn btn-neutral float-left" title="¿Qué es la invocación por protocolo?"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../MCF_manual-integrador_ES/" class="btn btn-neutral float-right" title="MCF manual integrador ES">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../Invocaci%C3%B3n%20por%20protocolo%20de%20aplicaciones%20nativas%20desde%20p%C3%A1ginas%20Web/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../MCF_manual-integrador_ES/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
