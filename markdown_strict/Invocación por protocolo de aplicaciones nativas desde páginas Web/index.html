<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>¿Qué es la invocación por protocolo? - My Docs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u00bfQu\u00e9 es la invocaci\u00f3n por protocolo?";
        var mkdocs_page_input_path = "markdown_strict/Invocaci\u00f3n por protocolo de aplicaciones nativas desde p\u00e1ginas Web.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> My Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Welcome to MkDocs</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Markdown strict</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Firmar_AutoFirma_Linux/">AF Firmar AutoFirma Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Firmar_AutoFirma_OS_X/">AF Firmar AutoFirma OS X</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Instalador%20Linux/">Preparación del entorno</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Instalador%20Mac%20OS%20X/">AF Instalador Mac OS X</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_Instalador%20Windows/">AF Instalador Windows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_desarrollo_plugins_ES/">AF manual desarrollo plugins ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_instalacion_usuarios_ES/">AF manual instalacion usuarios ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../AF_manual_instalacion_y_gestion_ES/">AF manual instalacion y gestion ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ANEXO_Firma-electronica-en-varias-fases/">Firma electrónica en tres fases</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_arquitectura_ES/">CF arquitectura ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_catalogo_aplicaciones/">CF catalogo aplicaciones</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_distribuciones/">CF distribuciones</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_funcional_ES/">CF funcional ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-incidencias/">CF guia incidencias</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-uso-interfaz/">CF guia uso interfaz</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_guia-uso/">CF guia uso</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-firmas-pdf/">CF manual firmas pdf</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-firmas-xml/">CF manual firmas xml</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-integrador/">CF manual integrador</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual-migracion/">CF manual migracion</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_manual_integracion_modulos_ES/">CF manual integracion modulos ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_plan-pruebas/">CF plan pruebas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CF_roadmap_ES/">CF roadmap ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Comunicacion_Navegador_y_App_en_Entorno_Movil/">El camino de ida: Desde el navegador Web hacia la App</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../DECLARACION_ACCESIBILIDAD/">Declaración de Accesibilidad</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Diagramas%20de%20secuencia%20de%20los%20procesos%20de%20firma%20m%C3%B3vil/">Firma monofásica (Windows 8 / Windows RT y Android)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Firma_por_lotes_predefinidos_con_el_MiniApplet_Cliente/">Firma por lotes predefinidos con el MiniApplet Cliente</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Informe%20-%20Alternativas_Applets_para_firma/">Informe   Alternativas Applets para firma</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">¿Qué es la invocación por protocolo?</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../La_seguridad_en_el_Servicio_de_firma_del_Cliente/">Tabla de contenido</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MCF_manual-integrador_ES/">MCF manual integrador ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MCF_roadmap_ES/">MCF roadmap ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Manual%20para%20la%20configuraci%C3%B3n%20de%20los%20campos%20de%20firma%20para%20la%20aplicaci%C3%B3n%20de%20firma%20manuscrita%20en%20tableta/">Manual para la configuración de los campos de firma para la aplicación de firma manuscrita en tableta</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_Manual_App_Portafirmas_Android/">PF Manual App Portafirmas Android</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_Manual_App_Portafirmas_iOS/">PF Manual App Portafirmas iOS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PF_manual-configuracion_servicios_ES/">PF manual configuracion servicios ES</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Sintaxis_invocacion_Cliente_Afirma/">Sintaxis invocacion Cliente Afirma</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../afirma_movil_intro/"><<img src="media/image1.jpeg"</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">My Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Markdown strict</li>
      <li class="breadcrumb-item active">¿Qué es la invocación por protocolo?</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="que-es-la-invocacion-por-protocolo">¿Qué es la invocación por protocolo?</h1>
<p>Es un funcionamiento universal que los sistemas operativos mantengan una
serie de asociaciones entre tipos de fichero y las aplicaciones que son
capaces de tratarlos. Así, si en un sistema operativo Windows se indica
que se abra un documento de texto, este consultará en el Registro de
Windows cual es la aplicación por defecto asociada para su tratamiento
(usualmente el Bloc de Notas), y procederá a abrir esta aplicación
pasando como parámetro la ruta completa del fichero en el esquema de
argumentos definido en el propio Registro de Windows como parte de la
asociación.</p>
<p>Esta asociación se hace de distintas formas según el sistema operativo,
en Windows es por su extensión (“.txt” en nuestro ejemplo), pero por
ejemplo en Linux es por su MIME-Type (text/plain en el ejemplo).</p>
<p>Este mismo esquema se define igualmente en la mayoría de los sistemas
operativos también para los esquemas comunes de protocolos basados en
URN/URI/URL. Así, si por ejemplo en un sistema operativo Windows
indicamos que queremos abrir <a href="http://www.atos.net">http://www.atos.net</a> (por ejemplo, desde
la línea de comandos con la sentencia “start <a href="http://www.atos.net">http://www.atos.net</a>”) se
iniciará el navegador Web por defecto, que es la aplicación asociada
para tratar el protocolo <em>http,</em> procediendo a abrir esa página Web.</p>
<p>Este modo de abrir aplicaciones se conoce como invocación por protocolo,
y de forma análoga a la invocación de aplicaciones indicando abrir un
fichero, donde antes se recibía la ruta completa del fichero a abrir,
ahora se recibe la URL/URI/URN completa que se indicó abrir.</p>
<h1 id="invocacion-por-protocolo-desde-navegador-web">Invocación por protocolo desde navegador Web</h1>
<p>Este mecanismo de invocación por protocolo de los sistemas operativos es
usualmente accesible desde los navegadores Web. Esto quiere decir que si
en la barra de direcciones del navegador Web indicamos una URI, el
navegador Web trasladará el control al sistema operativo para que este
localice la aplicación apropiada para tratar el protocolo asociado a la
URI, y la abra pasándole dicha URI.</p>
<p>Un ejemplo de este mecanismo en Apple iOS podría ser el soporte del
protocolo tel en forma de URN con el formato tel: //1-408-555-5555,
donde 1-408-555-5555 es un número de teléfono. Así una llamada desde una
página Web a esta URN con una sentencia HTML como la siguiente, &lt;a
href="tel://1-408-555-5555"&gt;1-408-555-5555&lt;/a&gt;,provoca que se
active el teléfono (en un iPhone) y realice una llamada a ese número, ya
que la aplicación nativa de teléfono de iOS tiene registrado ese esquema
de protocolo.</p>
<p>En este caso tenemos una salvedad evidente, y es que el navegador Web
obviará esta transferencia de control al sistema operativo cuando el
propio navegador sepa tratar el protocolo, por ejemplo, con <em>http</em>,
<em>https</em>, <em>ftp</em>, etc.</p>
<h2 id="advertencias-de-apertura">Advertencias de apertura</h2>
<p>Como la invocación por protocolo no deja de ser una transferencia de
datos desde una página Web (que no tiene porqué ser de confianza) a una
aplicación nativa, los navegadores Web acostumbran a advertir de este
cambio al usuario:</p>
<p><img
src="Invocación por protocolo de aplicaciones nativas desde páginas Web/media/image1.png"
style="width:3.41667in;height:3.64583in"
alt="C:\Users\tomas\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.Outlook\Q2TC4JUS\windows7_firefox.png" /></p>
<p>Ilustración 1: Advertencia en Firefox sobre Windows 7</p>
<p><img
src="Invocación por protocolo de aplicaciones nativas desde páginas Web/media/image2.png"
style="width:4.60417in;height:4.63542in"
alt="C:\Users\tomas\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.Outlook\Q2TC4JUS\windows7_chrome.png" /></p>
<p>Ilustración 2: Advertencia en Google Chrome sobre Windows 7</p>
<p><img
src="Invocación por protocolo de aplicaciones nativas desde páginas Web/media/image3.png"
style="width:4.38542in;height:3.21875in"
alt="C:\Users\tomas\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.Outlook\Q2TC4JUS\windows7_ie9.png" /></p>
<p>Ilustración 3: Advertencia en Internet Explorer 9 sobre Windows 7</p>
<p>En general, todos los navegadores Web muestran algún tipo de
advertencia, excepto Apple Safari en Windows, OS X e iOS y WebKit
(Android). En el caso de Internet Explorer se comprueba además la firma
electrónica del ejecutable del programa nativo invocado.</p>
<h2 id="soporte-de-la-invocacion-por-protocolo-en-los-distintos-navegadores">Soporte de la invocación por protocolo en los distintos navegadores</h2>
<p>En general, únicamente Internet Explorer sobre Windows Phone 7.x
presenta incompatibilidades con la invocación por protocolo (que no
funciona cuando se pide abrir un protocolo desde JavaScript, pero sí
cuando se hace una redirección mediante un META HTML). La invocación por
protocolo funciona adecuadamente en Windows Phone 8.x.</p>
<p>Las pruebas de compatibilidad positiva se han realizado en Windows (XP,
Vista, 7, 8, 8.1), Windows RT (8, 8.1), Windows Phone (8), Android
(4.x), iOS (5, 6, 7), OS X (10.7, 10.8, 10.9) y Linux (varias
distribuciones y versiones).</p>
<h1 id="la-invocacion-por-protocolo-como-sustituto-de-los-applets-de-java">La invocación por protocolo como sustituto de los Applets de Java</h1>
<p>La invocación por protocolo puede, en ciertos casos, plantearse como un
sustituto de los Applets de Java, si bien es necesario tener en cuenta
siempre:</p>
<ul>
<li>
<p>En ciertos sistemas operativos, la invocación de una aplicación
    desde el navegador Web provoca un cambio de contexto gráfico molesto
    para el usuario (desde el navegador a la aplicación), y además al
    cerrarse la aplicación no siempre se vuelve de forma automática al
    navegador.</p>
<ul>
<li>
<p>Sistemas operativos con cambios de contexto:</p>
<ul>
<li>
<p>Microsoft Windows 8 en modo UI Moderno.</p>
</li>
<li>
<p>Apple iOS</p>
</li>
</ul>
</li>
<li>
<p>Sistemas operativos sin cambio de contexto:</p>
<ul>
<li>
<p>Apple OS X</p>
</li>
<li>
<p>Microsoft Windows</p>
</li>
<li>
<p>Google Android</p>
</li>
<li>
<p>Linux</p>
</li>
</ul>
</li>
<li>
<p>Sistemas operativos con un “cambio parcial” de contexto (la
    experiencia de usuario es aceptable)</p>
<ul>
<li>Microsoft Windows 8.1</li>
</ul>
</li>
</ul>
</li>
<li>
<p>No es posible tener un UI integrado en la página Web, como ocurre
    con los Applets de Java, Adobe Flash o los controles Active X.</p>
</li>
<li>
<p>Una vez se invoca la aplicación desde el navegador, no puede existir
    una comunicación bidireccional directa entre ambos (aplicación
    nativa y JavaScript de la página Web), como sí ocurre en los Applets
    de Java.</p>
<ul>
<li>La aplicación nativa, no obstante, puede recibir información en
    la propia URL de invocación, aunque hay que tener en cuenta que
    la longitud de esta es limitada.</li>
</ul>
</li>
</ul>
<h2 id="comunicacion-entre-aplicacion-nativa-y-aplicacion-javascript-en-el-navegador-que-la-invoco">Comunicación entre aplicación nativa y aplicación JavaScript en el navegador que la invocó</h2>
<p>Como hemos comentado, una aplicación JavaScript ejecutándose en un
navegador Web puede invocar una aplicación nativa siempre que esta esté
registrada como la aplicación por defecto para tratar un protocolo que
no trate el propio navegador (por ejemplo, el Cliente @firma usa el
protocolo <em>afirma</em> en una URI del estilo <em>afirma://</em>), proporcionando
ciertos datos como parte de la propia URI de invocación, pero… ¿Cómo
puede la aplicación nativa devolver datos a la aplicación JavaScript?</p>
<p>El modo más directo y sencillo es usar un servidor (accesible por ambas
partes) como intermediario en ese diálogo, en una secuencia acorde al
siguiente esquema:</p>
<p><img
src="Invocación por protocolo de aplicaciones nativas desde páginas Web/media/image4.emf"
style="width:5.90556in;height:3.25526in" /></p>
<ol>
<li>
<p>El navegador Web invoca a una <em>App</em> nativa mediante una URI
    especial, indicando una serie de información (datos a firmar,
    formato, opciones, etc.).</p>
</li>
<li>
<p>La <em>App</em> recibe los datos y realiza la firma electrónica usando las
    funciones nativas de gestión de claves y certificados.</p>
</li>
<li>
<p>La <em>App</em> nativa deposita el resultado de la firma en un servidor
    intermediario mediante una llamada a un servicio Web simple.</p>
</li>
<li>
<p>El navegador Web recoge el resultado de la operación de firma del
    servidor intermediario y continúa la ejecución de la lógica de
    negocio.</p>
</li>
</ol>
<p>Como resultado tenemos una comunicación cuasi-bidireccional entre
navegador Web (JavaScript) y <em>App</em> nativa, supliendo completamente a los
complementos tradicionales.</p>
<p>Este modelo no obstante, requiere de ciertas precauciones para resultar
eficaz y seguro:</p>
<ul>
<li>
<p>El servidor intermediario y la aplicación Web deben estar en el
    mismo servidor (para evitar advertencias de <em>cross site scripting</em>).
    Si se usa SSL cliente, este debe requerirse únicamente en el
    servidor que aloja la aplicación Web, y no en el servidor
    intermediario (para evitar una solicitud de autenticación a la
    aplicación nativa), pero siempre estando ambos con HTTPS en el mismo
    nombre de servidor.</p>
</li>
<li>
<p>El servidor intermediario debe implementar mecanismos para
    asegurarse de que los datos depositados por una aplicación nativa
    sean recogidos únicamente por la aplicación JavaScript que la
    invocó:</p>
<ul>
<li>
<p>Para ello deben implementarse al menos <u>todos</u> estos
    mecanismos:</p>
<ul>
<li>
<p>Los datos deben cifrarse mediante una clave aleatoria de un
    solo uso generada al vuelo desde el programa JavaScript, que
    se pasa a la aplicación nativa mediante la URI de
    invocación.</p>
</li>
<li>
<p>Los datos deben tener un identificador aleatorio de un solo
    uso generado al vuelo desde el programa JavaScript, que se
    pasa a la aplicación nativa mediante la URI de invocación.</p>
</li>
<li>
<p>El servidor debe borrar cualquier dato que se deposite en él
    y que no sea requerido en un tiempo determinado (unos pocos
    minutos, que es lo máximo que puede durar la operación en la
    aplicación nativa).</p>
</li>
</ul>
</li>
<li>
<p>No deben implementarse mecanismos derivados de la dirección IP,
    ya que las conexiones 3G pueden variar de IP en una misma
    sesión.</p>
</li>
</ul>
</li>
</ul>
<h1 id="el-cliente-firma-y-la-invocacion-por-protocolo">El Cliente @firma y la invocación por protocolo</h1>
<p>El Cliente @firma está actualmente adoptando la estrategia de la
invocación por protocolo como sustitución de los Applets de Java (por
los constante problemas de seguridad y compatibilidad) mediante:</p>
<ul>
<li>
<p>Windows, Linux, OS X.</p>
<ul>
<li>Distribución de la aplicación “Firma Fácil con @firma”, una
    aplicación Java de escritorio cuyo instalador registra como
    aplicación por defecto para el protocolo “afirma”.</li>
</ul>
</li>
<li>
<p>Windows RT</p>
<ul>
<li>
<p>Aplicación nativa específica.</p>
<ul>
<li>Se usa el protocolo “afirmametro” para no interferir en los
    casos de Windows 8 y 8.1 que puedan tener Java y “Firma
    Fácil con @firma” instalado.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>iOS</p>
<ul>
<li>Aplicación nativa específica.</li>
</ul>
</li>
<li>
<p>Android</p>
<ul>
<li>Aplicación nativa específica</li>
</ul>
</li>
</ul>
<p>Se plantean para el futuro aplicaciones nativas para otros entornos que
no soporten Java, como Windows Phone o BlackBerry 10.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../Informe%20-%20Alternativas_Applets_para_firma/" class="btn btn-neutral float-left" title="Informe   Alternativas Applets para firma"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../La_seguridad_en_el_Servicio_de_firma_del_Cliente/" class="btn btn-neutral float-right" title="Tabla de contenido">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../Informe%20-%20Alternativas_Applets_para_firma/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../La_seguridad_en_el_Servicio_de_firma_del_Cliente/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
